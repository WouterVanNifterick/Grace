=============================================================================
     TODO HIGH
=============================================================================
- Bug: 
  - Create cubase project
  - add multiple Lucidity instances.
  - create and activate new cubase project.
  - close first cubase project
  - there is a bug somewhere round here.

- need to be able to read loop points from wav file.

- random LFOs always reset to 0. Might be the same for the step sequencers 
  when used as mod sources.

- Is the comb filter reseting it's delay buffer? when be retriggered?

- Bug: Crash after loading program via drag and drop. (can't reproduce reliably yet.)

- Dragging over the sample map display but not clicking de-selects the current
  selected region.

- Need to test SFZ import.

- Filter Gain needs more bite. 
- rethink the filter gain. try adding the gain stage before the filter.
-- maybe it's ok. I could try an additional gain stage before the filter.

- Add a contact support command.
-- Email
-- Forum
-- Website
-- Report Bug
-- check for updates. 

- ZeroObject should have a IDataObject reference. Will allow messages to be sent 
  across thread boundaries using delayed message sending.

- Clicking and immediately dragging a sample in the browser causes a audible glitch.

- there is still an occasional click but it might be passable enough for release. 
  I'm not sure where the clicking is coming from.
  Try replacing all critical sections with slim-reader-writer locks. perhaps.



PS : one thing that i *really*don't like in Lucidity, is that the default patch has everything disabled by default (the volume is set at zero, the enveloppe release is set at zero too, so as soon as you load a sound, you expect to hear it when hitting a key but it is actually muted) : is it by design, or could it be changed in a forthcoming version ?
From Yann
thunderlink://messageid=CAP8CW6OMk6qV82OX5422fAmqVbkWuc=cbfCbtxNx32vqALNEPA@mail.gmail.com
-- It shouldn't be doing this anymore. 

- need a "Move Sample To New Key Group..." command. 


=============================================================================
> is it possible to layer groups and use different Amp, Filter, 
> Mod settings for each group? The knobs seem to change from group to 
> group but as soon as I edit something all groups are affected the 
> same. 
It should be possible to use different amp, filter and mod settings for each group. It might be a bug. I'll take a look. 

Send this dude a new build and check if he can now use different settings for each group.

=============================================================================


=============================================================================
     TODO MED
=============================================================================

--------Optimisation Ideas----------------------------------------------------
-- instead of caluclating the LFO, Env and Seq values each step, maybe 
   use some sort of approximation. The mod sources will be calculated at some 
   lower control rate while, while updated at a faster rate using something 
   like: 
   	CurrentValue := CurrentValue + StepSize. 
   StepSize will be calculated at the control rate. Whatever it is. 

  Using a scheme like this, it's possible that the "Slow Control Rate" 
  value could be updated 10 times a second or less. The modulation sources
  could be interpolated at the faster control rate or audio rate.

-- The process loop is a little deep at the moment. There are multiple loops.
   Consider: there is the key group processing loop to process all values 
   that belong to this loop. 
   Instead. Each voice should be pointed to an output buffer. Voices could
   then be processed in one group. 
--------------------------------------------------------------------------------  



- Have a "Loading Sample" popup show when trying to load a sample.

- A "Swap Effect Order" command

- sample map trigger display should have a minimum trigger time so it's not 
  epilisy inducing.  

- filters finished. 

- make LFO phases random. ?
- switch between random and reset LFO phase on trigger. ? 

Right Click and Hold for sample zoom with mouse
- Left/Right moves the offset.
- Up/Down zooms in/out

- would be good to figure out the text drawing and use a higher quality text drawing routine!

- Update the installer so that Default.lpg isn't overwritten. (the default patch.)

- might need a 'reverse sample' command.

- look at more mouse wheel support!

- Current parameters are quantised at the knob level. (Tune is the only
  parameter being quantised so far.) It would be good to quantise the same
  parameter when input by MIDI Automation or VST Parameter Automation.  

- Need to respond when samples are missing.
  - need to be able to right click the sample display that show "audio file not found"
    the context menu should give options for finding or replacing the sample with another.

- An auto select on MIDI input would be nice.

- A move all regions to separate key groups would be nice. When moving to a new
  key group, current key group settings should be duplicated.

- Trigger region when pressing on key zone.

- clicking on sample name in sample display should pop up list of other samples. 
  perhaps divided by key group.

 - Sample map. load a patch with a missing sample so that the sample map shows a red region.
   Highlight and select the region. The region is red but the highlight is blue. It creates
   an ugly purple color. It should be a red highlight for error samples. 

- key zone context menu needs a 'Move Key Zone to New Key Group'

* « open sample in_audio editor _»
- requested by yann
- thunderlink://messageid=CAP8CW6NeN4AkV9awPK5kF8ut8EdycpTetVSObpWLQ=u_wChUaQ@mail.gmail.com

=============================================================================
     TODO LOW
=============================================================================
  Fundamentals Delphi Library contains a RSA encryption implementation. Investigate.
  http://sourceforge.net/projects/fundementals/?source=directory




=============================================================================
     Notes and Things to Think About
=============================================================================
==TODO==
Feature Request: In place preview. Current sample is replaced by preview sample.


* Possible effects
  multiband compressor, bit crusher, multiband EQ, chorus, delay, reverb, distortion, phaser, plate reverb, destroyer, flanger, space pan, limiter, sub generator, EQ 10 bands, analog delay, pitch shift chorus, vocal filter, analog chorus, leslie


=============================================================================
     Random Bits
=============================================================================

- I have found a small bug : when using long sample names, the sample name is written all over the parameters values (like tune/volume, etc). 
- zones can be duplicated by holding ALT while dragging a sample zone in the key zone editor. (I'll make this a command in the context menu.)
- thunderlink://messageid=C96432EDCAD443F880A0337122247144@YannHP

* Lucidity Notes from Yann
I noticed a couple of quirks, bugs & strange behaviour, so i wanted to report it :
- If i copy an instance of Lucidity from one Reaper track into another (with samples i drag/dropped from the DAW, not 

from Lucidity's own browser), the audio content will play fine, but no sample is visible in the keymapper (but i see the 

red keys blinkning when a note is triggered). So, i can not edit the samples or maps, as i can't see it.
- The "magnetism" ("grid locking" ?) of the keymapper is not perfect yet : i like gridlocking a lot (as it is a 

timesaver), but here sometimes i can not smoothly change the mapping when i drag a zone border/handle : it is way too 

strong : instead of jumping from note to note, it keeps jumping from half an octave.
-- thunderlink://messageid=CAP8CW6OnfgNORXUYZf6EpWMy1+d2doB+qFUvjbk7bUiUbuhZ4g@mail.gmail.com








- currently each sample map has a bitmap rendering of its image for fast display.
  Instead try to use a "Peak Buffer" of bytes. The sample map will draw the
  peak buffer.
  -- Peak buffers are now in, but the implementation is a bit messy.
  The current setup is also causing lags when interacting with the GUI while the
  sample is redrawn.
  -- Continue working on the SampleImageRenderer class.
  --- SampleRenderer needs to be able to draw with offset and zoom.


sample display
- change pitch to Tune & Fine.

Sample map
- add scrollable Root Key, LowKey, High Key, Low Vel, High Vel fields.


* Check samples are saved using relative paths when saving programs.
* check that programs can be moved.
* try adding a draft playback mode using linear resampling.
** would use best sampling when rendering down.

* The key zone needs to put it's resize handles on the outside when the key zone
  is really small.

* Check output latency of resampler and how much quality adjustments
  change it.
* Look for all locks using in audio thread.
* knob menu should have a 'reset to default' command
* SFZ support example - http://www.linuxsampler.org/sfz/
* lofi filter needs to have it's sample rate reduction knob polarity reversed.
  -- I wonder if it's possible to scale the samplerate reduction to match the
     1 volt/octave to match pitch signals.
* add midi velocity as a mod source.
* about box needs to be completed.

* LOFI - Bit Depth knob needs to be reversed.


* Removing MtxVec would reduce the install file size and required memory.
  MtxVec is used for it's FFT routines. It's used by the filter FFT display.


==Bug report==
GUI disappears in Samplitude Music Studio 16
thunderlink://messageid=CANuKor_nDaqXRv_dOR5O+Sb2Q1Ksn-bVXehEC9pcgQyaKGE6qA@mail.gmail.com
christianscheggia@gmail.com


==TODO==
Key Group Trigger Modes
- Note On
- Trigger
- Trigger on Release
- Latch

Latch requested by Scott
thunderlink://messageid=1384437336.34548.YahooMailNeo@web171506.mail.ir2.yahoo.com



==TODO==
Add new sample start offset destination. controls where the sample starts playing
  from. not the sample lenght.


==Performance tuning==
Eigen
http://eigen.tuxfamily.org/dox/GettingStarted.html

==TODO==
* Browser needs to be updated after saving a patch.

==TODO==
  Code Smell:
  IRegion has a GetKeyGroup() function which returns an IKeyGroup.
  I think this has the potential to blow up at some point in the future.
  I think a "Region" object should belong to a "KeyGroup". If so, the "Region"
  probably shouldn't maintain a reference to IKeyGroup. There is a potential
  for circular interface references and might be resulting in memory leaks.



==TODO==
Write a generic list that will be fast to use in the audio thread. It should minimise memory get/free operations.
Stepping through the list sequentially should be fast.
Should be able to nil items.


==TODO==
  loop edit dialog could use a drag and drop operation to zoom in.
  double click to zoom out to full view. (this would work in the main sample display
  area instead of only the zoom scroll bar area.


==TODO==
- create regions for samples that don't load. mark the region as bad. show an
  error message when selected or moused over.
- context menu can give options to rectify the error.

==TODO==
  Need an about page.

==TODO==
  Need dialog and code to find missing samples. Do it really minimal for the time being.
  IE. Show something. "Sample is missing. Locate? Ignore?"

==TODO==
  Need copy protection.

==TODO==
  Pan can be a modulation destination but not have any onscreen
  controls (for the time being at least).

==TODO==
  It would be great to have a sample store that would hold sample data.
  The sample data would be saved into the project file when a project file is saved.
  For this to work, sample data would need some type of finger print.
  (Sample name, sample length, hash of sample data content).
  The sample store would need to be limited to some size to prevent
  the project file filling with gigs of sample content.
  - 3mb?
  Audio file compression could be used as well to make best use of the space.

==TODO==
- need to load loop points from audio file.
- double clicking on an item in the browser should do something.
-- double clicking on a folder opens/closes it. Useless!!

==TODO==
Step sequencer needs a mutate option.

- Mutate off: duh. No mutation
- Mutate : each triggered step has a 10% chance of mutating.
- Mutate-Reset : each triggered step has a 10% chance of mutating. Steps are reset to
    their original postion each time a note is triggered.

-- Mutate has been (partially) implemented but the mutated steps aren't
   reported by the GUI. Maybe as an option there needs to be some sort of group
   Step data object that all voices share. It feels a bit hacky... but
   it would allow for all voices to mutate steps and share the same mutated
   sequence. If voices mutate their own internal step values only, the sequencers
   could potentially be completely different for each voice.



==TODO==
LFO's have tempo sync.
LFO's sync to other LFO's.
- Free (uses hertz)
- Tempo (sync to tempo)
- Sync (sync to the left LFO)






==TODO==
The options should have a "Search Folders" section. Lucidity will
automatically search these directories in case of missing samples.




==TODO==
  ### Serial Numbers And Copy Protection ####

There is no freely available asymmetric encryption library for
delphi that is easily used. :(

consider trying to implement RSA key encryption myself...

- need to update the eeGlobals so that sample rate changed events and all
the other notify events are sent as constants.
All classes will register a listener and can listen out for all constants.
This will mean the same code will be used for samplerate change events
push other stuff through the channel so the CP stuff becomes obscured.



==TODO==

I am using TCriticallyDampedLowpass in a few places. One place is smoothing
the mod wheel, pitch bend and MIDI note values for monophonic signals.

behind the scenes TCriticallyDampedLowpass is using a biquad filter. Using
Direct Form 2 and Direct Form 2 Transposed topologies the filter will explode
with sudden changes in coefficients.

The filter doesn't explode using Direct Form 1. The downside is DF1 uses four
intermediate variables to store the filter state.



==TODO==
> Could we imagine that the bottom part of the browesr could display
> a_thumbnail_ attached to a sample ?
thunderlink://messageid=CAP8CW6NeN4AkV9awPK5kF8ut8EdycpTetVSObpWLQ=u_wChUaQ@mail.gmail.com


==TODO==
- Can we _hide the browser _(like in Poise) ?
thunderlink://messageid=CAP8CW6NeN4AkV9awPK5kF8ut8EdycpTetVSObpWLQ=u_wChUaQ@mail.gmail.com



=============================================================================
Hotkeys

Hotkeys should be implemented as:

Two hotkey files
- Factory/Config/Hotkeys.xml 
- User/Config/Hotkeys.xml

Should the original user hotkeys replace or be loaded in addition to the factory config. Might be ok 
either way. It's possible the user config should only contain overrides. 


- All key presses should be directed to a 'key press' handler in the globals unit.
- The globals unit should then pass anything registered as a hotkey to the GUI (if it's open.)

- It should be possible for controls to set themselves or other objects to 
  be the focus of hot key presses in the globals unit. 
- It should be possible to define a default handler if nothing has focus.

- The globals unit should have no understanding of what the key presses mean, it should
  only pass the relevent commands to the focused control. The focused control then 
  has the option to process the key or not. 
  Pass the key press to the default handler if it's not processed. Then pass the
  key press to the host application if it's not processed again.

- This would be a good system to have and could be incorporated into Poise.


=============================================================================
======= Parameter Smoothing ==================================
- Look at adding parameter smoothing.
  -- There is smoothing in a couple places already. Knobs are smooth their output.
     Cool but maybe unnecessary.
  -- Modulated parameters are smoothed in the KeyGroup class.
     This does have a performance hit however. 
- The current parameter smoothing system might be enough for V1 but 
  smoothing at the parameter change point might be better in the long run.
  That way all parameters can be optionally smoothed and it might be easier to  
  port to other plugins. 
=============================================================================





** MIDI Learn / Macro Knob Edit Page **

Page is a way to edit the midi controllers and macro knobs to parameters

- Parameter Source (MIDI CC or Macro Control)
- Destination Parameter (Filter 1 Parameter 1 etc)
- Scope - (Global/All Key Groups, Focused Key Group, Named Key Group)
- Mapping - maps the source control range to the destination parameter.



=============================================================================
                          VERSION 2.0 IDEAS
=============================================================================


== Meta control parameter mapping ==

Control is needed for music creation. It's not enough to have a static patch. 

All knobs/parameters should be linked to a controller, the mod wheel for example. 
A mod-map or mod-graph translates the controller position to the actual parameter
value. The mod-graph is a break point line. 

At it's most simple, each parameter would be linked to a mod-map, each mod-map would
be linked to one controller. It would be a master meta control. This idea could be
advanced by allowing more meta controllers. Also, lfos could be used for meta controllers
as well. 

Current examples are Mutable Instruments Frames. The exp-map in Alchemy.








